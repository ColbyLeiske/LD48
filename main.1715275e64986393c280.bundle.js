/*! For license information please see main.1715275e64986393c280.bundle.js.LICENSE.txt */
(()=>{var t,e={110:(t,e,s)=>{"use strict";s(260);const i=JSON.parse('{"nodes":[{"x":433,"y":258,"id":0,"canBeBusstop":true,"isBusstop":false},{"x":565,"y":203,"id":1,"canBeBusstop":true,"isBusstop":false},{"x":633,"y":303,"id":2,"canBeBusstop":true,"isBusstop":false},{"x":539,"y":344,"id":3,"canBeBusstop":true,"isBusstop":false},{"x":527,"y":325,"id":4,"canBeBusstop":true,"isBusstop":false},{"x":506,"y":335,"id":5,"canBeBusstop":true,"isBusstop":false}],"connections":[{"source":0,"dest":5,"weight":106.10372283760829},{"dest":0,"source":5,"weight":106.10372283760829},{"source":5,"dest":4,"weight":23.259406699226016},{"dest":5,"source":4,"weight":23.259406699226016},{"source":4,"dest":3,"weight":22.47220505424423},{"dest":4,"source":3,"weight":22.47220505424423},{"source":3,"dest":2,"weight":102.55242561733974},{"dest":3,"source":2,"weight":102.55242561733974},{"source":2,"dest":1,"weight":120.9297316626478},{"dest":2,"source":1,"weight":120.9297316626478},{"source":1,"dest":0,"weight":143},{"dest":1,"source":0,"weight":143}]}');class o extends Phaser.GameObjects.Text{constructor(t){super(t,10,10,"",{color:"black",fontSize:"28px"}),t.add.existing(this),this.setOrigin(0)}update(){this.setText(`FPS: ${Math.floor(this.scene.game.loop.actualFps)}`)}}class n{constructor(t,e,s,i=!1,o=!1){this.x=t,this.y=e,this.id=s,this.canBeBusstop=i,this.isBusstop=o}}class d{constructor(){this.nodes=[],this.edges=[]}addNode(t){this.nodes.push(t)}addConnection(t,e,s){console.log({source:t.id,dest:e.id,weight:s||1}),this.edges.push({source:t.id,dest:e.id,weight:s||1}),this.edges.push({source:e.id,dest:t.id,weight:s||1})}getConnections(t){return this.edges.filter((e=>{e.source===t||e.dest}))}doesConnectionExist(t,e,s){return this.edges.includes}getNode({x:t,y:e}){const s=this.nodes.filter((({x:s,y:i})=>Math.abs(t-s)<5&&Math.abs(e-i)<5));return s.length>=1?s[0]:new n(-1,-1,-1)}getNodeById(t){return this.nodes[t]}getNodesInRadius(t,e,s){return this.nodes.filter((({x:i,y:o})=>Math.abs(t-i)<s&&Math.abs(e-o)<s))}floydWarshallAlgorithm(){let t={},e={};for(let s=0;s<this.nodes.length;s++)t[s]=[],e[s]=[];for(let s=0;s<this.nodes.length;s++)this.edges.forEach((s=>{t[s.source][s.dest]=s.weight,e[s.source][s.dest]=s.dest})),this.nodes.forEach((i=>{null==t[this.nodes[s].id][i.id]&&(t[this.nodes[s].id][i.id]=1/0),this.nodes[s].id===s&&(t[s][s]=0,e[s][s]=s)}));return this.nodes.forEach((s=>{this.nodes.forEach((i=>{this.nodes.forEach((o=>{t[s.id][o.id]+t[o.id][i.id]<t[s.id][i.id]&&(t[s.id][i.id]=t[s.id][o.id]+t[o.id][i.id],e[s.id][i.id]=e[s.id][o.id])}))}))})),{dist:t,next:e}}getPath(t,e){if(!this.paths)return[];if(!this.paths[t.id][e.id])return[];let s=[t];for(;t!=e;)t=this.getNodeById(this.paths[t.id][e.id]),s.push(t);return s}getPathById(t,e){return this.getPath(this.getNodeById(t),this.getNodeById(e))}getNodesInRange(t,e,s=1/0){return this.weights[t.id].map(((t,e)=>({weight:t,index:e}))).filter((({weight:t})=>t>e&&t<s)).map((t=>this.getNodeById(t.index)))}dump(){console.log(JSON.stringify({nodes:this.nodes,connections:this.edges}))}updateEdgeWeight(t,e,s){s<1||this.edges.filter((i=>{(i.source==t&&i.dest==e||i.source==e&&i.dest==t)&&(i.weight=s)}))}loadFromJSON({nodes:t,connections:e}){this.nodes=t,this.edges=e;const{dist:s,next:i}=this.floydWarshallAlgorithm();this.paths=i,this.weights=s,console.log(s),console.log(i)}}class r extends Phaser.Scene{constructor(){super({key:"editorScene"}),this.lines=new Map}create(){this.grid=new d,this.add.sprite(0,0,"map").setOrigin(0),this.input.keyboard.addKey("Q").on("down",(t=>{this.scene.start("GameScene")})),this.add.rectangle(256,16,32,16,65280).setInteractive().on("pointerdown",(t=>{this.grid.dump()})),this.add.rectangle(512,16,32,16,15790095).setInteractive().on("pointerdown",(t=>{this.grid.loadFromJSON(i),this.grid.nodes.forEach((t=>{const e=t.canBeBusstop?65280:16711680;this.addNode(t.x,t.y,t.id,e)})),this.grid.edges.forEach((t=>{this.addConnection(this.grid.getNodeById(t.source),this.grid.getNodeById(t.dest))}))})),this.input.on("pointerdown",(t=>{if(this.input.keyboard.addKey("SPACE").isUp)return;const e=this.input.activePointer.worldX,s=this.input.activePointer.worldY,i=new n(Math.round(e),Math.round(s),this.grid.nodes.length);this.grid.addNode(i),this.addNode(e,s,i.id)})),this.input.on("wheel",((t,e,s,i,o)=>{this.cameras.main.setZoom(this.cameras.main.zoom-i/100),console.log({zoom:this.cameras.main.zoom})})),this.input.on("pointermove",(t=>{t.isDown&&this.input.keyboard.addKey("C").isDown&&(this.cameras.main.scrollX-=(t.x-t.prevPosition.x)/this.cameras.main.zoom,this.cameras.main.scrollY-=(t.y-t.prevPosition.y)/this.cameras.main.zoom)})),this.fpsText=new o(this)}addNode(t,e,s,i=16711680){const o=this.add.circle(t,e,5,i).setInteractive();this.add.text(t,e,s.toString(),{color:"black",fontSize:"12px"}).setOrigin(0),o.on("pointerdown",(t=>{var e,s;if(this.input.keyboard.addKey("E").isDown){if(this.editing&&this.editedStartNode===this.grid.getNode(t))return this.editedStartNode=new n(-1,-1,-1),this.editing=!1,void console.log("not editing anymore");if(this.editing){const i=this.grid.getNode(t);if(-1==i.id)return void console.log("early return");const o=Math.trunc(Math.max(Math.sqrt(Math.pow(this.editedStartNode.x-i.x,2)+Math.pow(this.editedStartNode.y-i.y,2)),1)),d=this.grid.edges.filter((({dest:t,source:e})=>this.editedStartNode.id==e&&i.id==t||this.editedStartNode.id==t&&i.id==e));if(d.length){console.log("truying to remove edge");const t=d[0],o=this.grid.edges.indexOf(t);return this.grid.edges.splice(o),console.log("trying ",{a:this.editedStartNode.id,b:i.id}),console.log("lines:",this.lines),null===(e=this.lines.get(JSON.stringify({a:this.editedStartNode.id,b:i.id})))||void 0===e||e.setVisible(!1).destroy(),null===(s=this.lines.get(JSON.stringify({a:i.id,b:this.editedStartNode.id})))||void 0===s||s.setVisible(!1).destroy(),void this.lines.delete(JSON.stringify({a:this.editedStartNode.id,b:i.id}))}return this.grid.addConnection(this.editedStartNode,i,o),this.addConnection(this.editedStartNode,i),this.editedStartNode=new n(-1,-1,-1),this.editing=!1,void console.log("not editing anymore")}console.log("now editing"),this.editing=!0,this.editedStartNode=this.grid.getNode(t)}if(this.input.keyboard.addKey("V").isDown&&console.log(this.grid.getNode(t)),this.input.keyboard.addKey("B").isDown){const e=this.grid.getNode(t);this.grid.nodes[e.id].canBeBusstop=!this.grid.nodes[e.id].canBeBusstop}}))}addConnection(t,e){const s=this.add.line(t.x,t.y,0,0,-1*(t.x-e.x),-1*(t.y-e.y),255).setOrigin(0);this.lines.set(JSON.stringify({a:t.id,b:e.id}),s),console.log({a:t.id,b:e.id},s)}update(){this.fpsText.update()}}class a extends Phaser.GameObjects.Text{constructor(t){super(t,1070,20,"",{color:"black",fontSize:"28px"}),t.add.existing(this),this.setOrigin(0)}update(t){this.setText(`Cash: $${t}`)}}class h extends Phaser.GameObjects.Sprite{constructor(t,e,s,i){super(t,e,s,"pin"),this.setTintFill(i),t.add.existing(this)}update(){}}var l=s(486),c=s.n(l);class g extends Phaser.GameObjects.Text{constructor(t,e,s,i){super(t,e,s-10,`+$${i}`,{color:"black",fontSize:"12px"}),t.add.existing(this),t.tweens.add({targets:this,y:this.y-10,alpha:0,onComplete:()=>{this.destroy()}}),this.setOrigin(0)}update(t){this.setText(`+ $${t}`)}}class u extends Phaser.GameObjects.Sprite{constructor(t,e){super(t,e.locations[0][0],e.locations[0][1],"bus"),this.route=e,this.ticks=0,this.setScale(.2),this.setAngle(-2.5).setZ(5),this.tweenTimeline=t.tweens.createTimeline({loop:-1});let s=0;for(let t=1;t<e.locations.length;t++){const[i,o]=e.locations[t-1],[n,d]=e.locations[t],r=Phaser.Math.Distance.Between(i,o,n,d);s+=r,this.tweenTimeline.add({targets:this,x:n,y:d,ease:"linear",duration:500+15*r})}for(let i=e.locations.length-1;i>0;i--){const[o,n]=e.locations[i-1],[d,r]=e.locations[i];let a=()=>{};i-1==0&&(a=()=>{t.editMoney(Math.trunc(s)/2),new g(t,o,n,Math.trunc(s)/2)}),this.tweenTimeline.add({targets:this,x:o,y:n,ease:"linear",duration:500+15*Phaser.Math.Distance.Between(o,n,d,r),onComplete:a})}this.tweenTimeline.add({targets:this,duration:250}),this.tweenTimeline.play(),this.tweenTimeline.setCallback("onComplete",(t=>{console.log("done")})),t.add.existing(this)}tick(){}}class p extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.addingNewRoute=!1,this.routes=[],this.busses=[],this.money=500,this.colors=[2007906,4884979,5268615,5753542,12376686,15954287,13848409],this.frameTime=0,this.stopCost=200,this.baseStopCost=250}create(){this.add.sprite(0,0,"map").setOrigin(0),this.moneyText=new a(this),this.input.keyboard.addKey("Q").on("down",(t=>{this.scene.start("editorScene")})),this.grid=new d,this.grid.loadFromJSON(i),this.potentialStopMarkers=this.add.group(),this.grid.nodes.filter((t=>t.canBeBusstop)).forEach((t=>{const e=this.add.sprite(t.x+2,t.y-10,"stopPin").setInteractive().setDataEnabled().setData("nodeid",t.id);e.on("pointerdown",(s=>{if(this.input.keyboard.addKey("V").isDown)return void console.log(this.grid.getNode(s));if(this.potentialFirstStop===e)return this.potentialFirstStop=void 0,e.clearTint(),void this.potentialStopMarkers.setVisible(!0).setActive(!0);if(this.potentialFirstStop){const t=c().sample(this.colors);console.log(t);const s=new h(this,this.potentialFirstStop.x-2,this.potentialFirstStop.y-2,t),i=new h(this,e.x-2,e.y-2,t),o=this.grid.getPathById(this.potentialFirstStop.getData("nodeid"),e.getData("nodeid")).map((t=>[t.x,t.y]));console.log(o);let n=[];for(let e=1;e<o.length;e++){const[s,i]=o[e-1],[d,r]=o[e];n.push(this.addLine(s,i,d,r,t))}const d={pinA:s,pinB:i,routeLines:n,id:this.routes.length,locations:o};return this.routes.push(),this.potentialFirstStop.setData("isBusStop",!0),e.setData("isBusStop",!0),this.potentialStopMarkers.remove(e,!0),this.potentialStopMarkers.remove(this.potentialFirstStop,!0),this.toggleNewRoute(),this.editMoney(-this.stopCost),void this.busses.push(new u(this,d))}this.potentialFirstStop=e,e.setTint(11184640),e.tintFill=!0;const i=this.grid.getNodesInRange(t,2);console.log(`within range ${JSON.stringify(i)}`);const o=i.map((t=>t.id));this.potentialStopMarkers.getChildren().filter((t=>{var e;const s=t.getData("nodeid");return!o.includes(s)&&s!=(null===(e=this.potentialFirstStop)||void 0===e?void 0:e.getData("nodeid"))})).forEach((t=>{t.setActive(!1),t.setVisible(!1)}))})),this.potentialStopMarkers.add(e)})),this.potentialStopMarkers.setVisible(!1).setActive(!1),this.modeText=this.add.text(400,10,"Adding Route").setVisible(!1),this.newRouteButton=this.add.rectangle(1200,685,120,42,65280).setInteractive().on("pointerdown",(t=>{this.toggleNewRoute()})),this.add.text(1160,677,"New Route").setColor("black"),this.input.keyboard.addKey("ESC").on("down",(t=>{this.addingNewRoute&&this.toggleNewRoute()}))}toggleNewRoute(){this.addingNewRoute=!this.addingNewRoute,this.modeText.setVisible(this.addingNewRoute),this.potentialStopMarkers.setVisible(this.addingNewRoute).setActive(this.addingNewRoute),this.potentialFirstStop=void 0,this.potentialStopMarkers.setTint(16777215)}addLine(t,e,s,i,o){return this.add.line(t,e,0,0,-1*(t-s),-1*(e-i),o).setOrigin(0).setLineWidth(2)}editMoney(t){console.log("updating money"),this.money+=t,this.money<this.stopCost?(this.newRouteButton.setActive(!1),this.newRouteButton.setFillStyle(11184810)):(this.newRouteButton.setActive(!0),this.newRouteButton.setFillStyle(65280))}update(t,e){this.moneyText.update(this.money),this.frameTime+=e,this.frameTime>16.5&&(this.frameTime=0)}}class f extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.image("map","assets/maps/startermap.png"),this.load.image("stopPin","assets/misc/pin.png"),this.load.image("pin","assets/misc/pinclear.png"),this.load.image("noMoneyPin","assets/misc/nomoneypin.png"),this.load.image("bus","assets/misc/bus.png")}create(){this.scene.start("editorScene")}}const m={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1280,height:720},scene:[f,p,r]};window.addEventListener("load",(()=>{new Phaser.Game(m)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(t){var o=s[t];if(void 0!==o)return o.exports;var n=s[t]={id:t,loaded:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.m=e,t=[],i.O=(e,s,o,n)=>{if(!s){var d=1/0;for(h=0;h<t.length;h++){for(var[s,o,n]=t[h],r=!0,a=0;a<s.length;a++)(!1&n||d>=n)&&Object.keys(i.O).every((t=>i.O[t](s[a])))?s.splice(a--,1):(r=!1,n<d&&(d=n));r&&(t.splice(h--,1),e=o())}return e}n=n||0;for(var h=t.length;h>0&&t[h-1][2]>n;h--)t[h]=t[h-1];t[h]=[s,o,n]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={179:0};i.O.j=e=>0===t[e];var e=(e,s)=>{var o,n,[d,r,a]=s,h=0;for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(a)var l=a(i);for(e&&e(s);h<d.length;h++)n=d[h],i.o(t,n)&&t[n]&&t[n][0](),t[d[h]]=0;return i.O(l)},s=self.webpackChunkld48=self.webpackChunkld48||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(110)));var o=i.O(void 0,[216],(()=>i(204)));o=i.O(o)})();